name: Build Light Bootstrap TCLabs (Legacy 0.65 Style)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 120 # Versão leve não deve passar de 1h

    steps:
      - name: Checkout (Focando em estabilidade)
        uses: actions/checkout@v4

      - name: Limpeza Extrema de Disco
        run: |
          sudo rm -rf /usr/share/dotnet /usr/local/lib/android /opt/ghc /usr/local/share/boost /usr/lib/mono
          docker image prune -a -f

      - name: Customizar Pacote e Otimizar Build
        run: |
          # 1. Mudar o ID do pacote
          sed -i 's/TERMUX_APP_PACKAGE="com.termux"/TERMUX_APP_PACKAGE="com.tclabs.codestudio"/g' ./scripts/properties.sh
          
          # 2. Truque para Bootstrap Leve: Reduzir a lista de pacotes "finais"
          # Isso evita que o script tente compilar centenas de utilitários pesados
          # Vamos manter apenas o essencial para o terminal abrir (bash, coreutils, apt)
          sed -i 's/TERMUX_PKGS_TO_INSTALL=.*/TERMUX_PKGS_TO_INSTALL="bash,coreutils,dash,diffutils,findutils,gawk,grep,sed,tar,termux-exec,termux-tools,util-linux,apt,ca-certificates,command-not-found,debianutils,dpkg,readline"/g' ./scripts/build-bootstraps.sh

      - name: Compilar Bootstrap (Apenas aarch64)
        run: |
          # O uso do script legacy para 0.65 requer menos recursos
          ./scripts/run-docker.sh ./scripts/build-bootstraps.sh --architectures aarch64

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: bootstrap-0.65-light-aarch64
          path: "*.zip"

